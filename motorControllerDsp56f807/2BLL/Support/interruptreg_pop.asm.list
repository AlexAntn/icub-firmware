Motorola DSP56800 Assembler  Version 6.3.16  110-11-03  12:48:55  C:\Software\iCub\firmware\controllerBll\Support\interruptreg_pop.asm  Page 1



1      
2                                    section rtlib
3                                    GLOBAL  INTERRUPTREGPOP
4                                    include "asmdef.h"
5      
6      
7      
8                          ;----------------------------------------------------------------------
9                          ;
10                         ; MSL
11                         ; Copyright ©1995-2006 Freescale Corporation.  All rights reserved.
12                         ;
13                         ; $Date: 2006/02/09 17:01:36 $
14                         ; $Revision: 1.3.4.2 $
15                         ;
16                         ;
17                         ;
18                         ;       Routines
19                         ;       --------
20                         ;       macros and defines for simplifying assembly coding
21                         ;
22                         ;----------------------------------------------------------------------
23                         ;
24     
25        0001             TRUE      equ     1
26        0000             FALSE     equ     0
27     
28                         ;
29                         ; Conditional assembly switch setting
30                         ;
31     
32        0000             REV_A2    equ     FALSE                             ; Set to true for configurations
33                                                                             ; with revision A2 of the DSP56811.
34     
35        0001             REV_B     equ     TRUE                              ; Set to true for configurations
36                                                                             ; with revision B of the DSP56811.
37     
38                         ;************************************************************************
39                         ;
40                         ; Macro definitions
41                         ;
42                         ;************************************************************************
43                         PUSH      MACRO   arg
44   m                               lea     (sp)+
45   m                               move    arg,x:(sp)
46   m                               ENDM
47     
48                         push      MACRO   arg
49   m                               lea     (sp)+
50   m                               move    arg,x:(sp)
51   m                               ENDM
52                         ;************************************************************************
53                         ;
54                         ; page0 register definitions
55                         ;
56                         ;************************************************************************
57     
58        0030             mr0       equ     x:$30
59        0031             mr1       equ     x:$31
60        0032             mr2       equ     x:$32
61        0033             mr3       equ     x:$33
62        0034             mr4       equ     x:$34
Motorola DSP56800 Assembler  Version 6.3.16  110-11-03  12:48:55  asmdef.h  Page 2



63        0035             mr5       equ     x:$35
64        0036             mr6       equ     x:$36
65        0037             mr7       equ     x:$37
66        0038             mr8       equ     x:$38
67        0039             mr9       equ     x:$39
68        003A             mr10      equ     x:$3A
69        003B             mr11      equ     x:$3B
70        003C             mr12      equ     x:$3C
71        003D             mr13      equ     x:$3D
72        003E             mr14      equ     x:$3E
73        003F             mr15      equ     x:$3F
74     
75        0030             MR0       equ     x:$30
76        0031             MR1       equ     x:$31
77        0032             MR2       equ     x:$32
78        0033             MR3       equ     x:$33
79        0034             MR4       equ     x:$34
80        0035             MR5       equ     x:$35
81        0036             MR6       equ     x:$36
82        0037             MR7       equ     x:$37
83        0038             MR8       equ     x:$38
84        0039             MR9       equ     x:$39
85        003A             MR10      equ     x:$3A
86        003B             MR11      equ     x:$3B
87        003C             MR12      equ     x:$3C
88        003D             MR13      equ     x:$3D
89        003E             MR14      equ     x:$3E
90        003F             MR15      equ     x:$3F
91     
92                         ;************************************************************************
93                         ;
94                         ; Peripheral register definitions for init56811.asm
95                         ;
96                         ;************************************************************************
97     
98        FFFB             IPR       equ     x:$FFFB                           ; Interrupt priority register
99     
100       FFF1             COPCTL    equ     x:$FFF1                           ; COP control regiser
101    
102       FFE6             SPCR1     equ     x:$FFE6                           ; SPI1 control register
103       FFE2             SPCR0     equ     x:$FFE2                           ; SPI0 control register
104    
105       FFDF             TCR01     equ     x:$FFDF                           ; Timer01 Control register
106       FFDA             TCR2      equ     x:$FFDA                           ; Timer2 control reg
107    
108       FFD2             MCR2      equ     x:$FFD2                           ; MMSI control reg 2
109    
110                        ;************************************************************************
111                        ;
112                        ; Assembly version of errno.h and signal.h
113                        ;
114                        ;************************************************************************
115       0006             signal_max equ    6
116       0001             SIGABRT   equ     1
117       0002             SIGFPE    equ     2
118       0003             SIGILL    equ     3
119       0004             SIGINT    equ     4
120       0005             SIGSEGV   equ     5
121       0006             SIGTERM   equ     6
122    
123       0000             ENOERR    equ     0
124       0021             EDOM      equ     33
Motorola DSP56800 Assembler  Version 6.3.16  110-11-03  12:48:55  asmdef.h  Page 3



125       0022             ERANGE    equ     34
126       0023             EFPOS     equ     35
127       0024             ESIGPARM  equ     36
128    
129       P:000000                   ORG     P:
130                        INTERRUPTREGPOP:
131                        ;
132                        ; Pop ALL registers from the stack in reverse
133                        ; order from the routine archPushAllRegisters
134                        ;
135    
136                                                                            ;
137                                                                            ; To return, we must simulate the original
138                                                                            ; jsr after popping all registers saved
139                                                                            ;
140                                                                            ; We use the stack space
141                                                                            ; from the call to archPushAllRegisters
142                                                                            ; to store the PC/SR for the RTS instruction
143                                                                            ;
144       P:000000 F31B              pop     Y1
145       P:000001 93E1              move              Y1,X:(SP-31)
146       P:000002 F31B              pop     Y1
147       P:000003 93E1              move              Y1,X:(SP-31)
148       P:000004 F31B              pop     Y1
149       P:000005 9337              move              Y1,X:<mr7
150       P:000006 F31B              pop     Y1
151       P:000007 9336              move              Y1,X:<mr6
152       P:000008 F31B              pop     Y1
153       P:000009 9335              move              Y1,X:<mr5
154       P:00000A F31B              pop     Y1
155       P:00000B 9334              move              Y1,X:<mr4
156       P:00000C F31B              pop     Y1
157       P:00000D 9333              move              Y1,X:<mr3
158       P:00000E F31B              pop     Y1
159       P:00000F 9332              move              Y1,X:<mr2
160       P:000010 F31B              pop     Y1
161       P:000011 9331              move              Y1,X:<mr1
162       P:000012 F31F              move              X:(SP),Y1               ; leave SP+1 for hardware stack restoration
163       P:000013 9330              move              Y1,X:<mr0
164    
165                                                                            ;
166                                                                            ; restore hardware stack
167                                                                            ;
168       P:000014 8F9B              move              HWS,LA
169       P:000015 8F9B              move              HWS,LA
170       P:000016 AAFE              brclr   #-32768,X:(SP-2),SkipHWS1
                   8082
171       P:000018 FBCB              move              X:(SP-1),HWS
                   FFFF
172                        SkipHWS1:
173       P:00001A AAFC              brclr   #-32768,X:(SP-4),SkipHWS2
                   8082
174       P:00001C FBCB              move              X:(SP-3),HWS
                   FFFD
175                        SkipHWS2:
176       P:00001E 9EFB              lea     (SP-5)
177                                                                            ;
178                                                                            ; restore all saved registers
179                                                                            ;
180       P:00001F FE9B              pop     LC
181       P:000020 F49B              pop     M01
182       P:000021 FF9B              pop     LA
Motorola DSP56800 Assembler  Version 6.3.16  110-11-03  12:48:55  C:\Software\iCub\firmware\controllerBll\Support\interruptreg_pop.asm  Page 4



183       P:000022 F89B              pop     OMR
184       P:000023 FB1B              pop     R3
185       P:000024 FA1B              pop     R2
186       P:000025 F91B              pop     R1
187       P:000026 F81B              pop     R0
188       P:000027 F39B              pop     B2
189       P:000028 F71B              pop     B1
190       P:000029 F19B              pop     B0
191       P:00002A F29B              pop     A2
192       P:00002B F61B              pop     A1
193       P:00002C F09B              pop     A0
194       P:00002D F31B              pop     Y1
195       P:00002E F11B              pop     Y0
196       P:00002F F01B              pop     X0
197       P:000030 FD1B              pop     N
198       P:000031 EDD8              rts
199    
200                                  ENDSEC
201                                  END

0    Errors
0    Warnings


